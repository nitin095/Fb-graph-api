<!DOCTYPE html>
<html>
<head>
	<title>Feed</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	 <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <style type="text/css">
  	body {
  		background-color: #eeeeee;
  	}
  	.padding {
  		padding: 20%;
  	}
  </style>
</head>
<body>
<nav>
    <div class="nav-wrapper">
      <a href="index.html" class="brand-logo">Graph API</a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a class="profileLink">Profile</a></li>
        <li class="active"><a class="feedLink">Feed</a></li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li><a class="profileLink">Profile</a></li>
        <li class="active"><a class="feedLink">Feed</a></li>
      </ul>
    </div>
  </nav>
  <div align="center" class="container padding">
<div class="loader preloader-wrapper big active">
    <div class="spinner-layer spinner-red-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>
  </div><!-- end loader container-->  
  <div class="container postsContainer">
  </div>

  <footer class="page-footer">
          <div class="container">
            <div class="row">
              <div class="col l6 s12">
                <h5 class="white-text">Footer Content</h5>
                <p class="grey-text text-lighten-4">You can use rows and columns here to organize your footer content.</p>
              </div>
              <div class="col l4 offset-l2 s12">
                <h5 class="white-text">Links</h5>
                <ul>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 1</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 2</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 3</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 4</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container" style="text-align: center;">
            Â© 2017 Nitin Shokeen
            </div>
          </div>
        </footer>
</body>
<script type="text/javascript">
	$(document).ready(function(){
		$(".button-collapse").sideNav();  
		$.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null){
       return null;
    }
    else{
       return decodeURI(results[1]) || 0;
    }
}

	var token = $.urlParam('token');
	$(".profileLink").attr("href","profile.html?token="+token);
	$(".feedLink").attr("href","feed.html?token="+token);
	var posts;
	getinfo();
	function getinfo(){ 
                      $.ajax('https://graph.facebook.com/me?fields=id,name,posts,cover&&access_token='+token,{ 
       	                       success : function(response){ 
                               console.log(typeof(response)); 
                               //$(".name").text(response.name); 
                               //$("#email").text(response.email);
                               posts = response.posts.data;
                 				pictureLink = "http://graph.facebook.com/"+response.id+"/picture?type=normal";
                               coverLink = response.cover.source;
                              	},//end sucess 
                               error : function(request,errorType,errorMessage){ 
                               console.log(request); 
                               console.log(errorType); 
                               alert(errorMessage); 
                               alert("API is down. Please try again later."); 
                               },//end error 

                               timeout:5000, 

                               beforeSend : function(){ 

                               $('.-loader').show(); 

                               },//end beforeSend 

                              complete : function(){ 

                              $('.loader').hide();
                              $('.padding').removeClass("padding");
                              //$('#data').show();
            				 // $("#coverPic").attr("src",coverLink);
            					$(".profilePic").attr("src",pictureLink);
            					console.log(posts);
            					console.log("length: "+posts.length);
            					for (var i = 0; i < posts.length; i++) {
            						if (posts[i].message == undefined ) {
            							makePost(pictureLink,posts[i].story,posts[i].created_time,"");
        							}
        							else if (posts[i].story == undefined) {
        								makePost(pictureLink,"",posts[i].created_time,posts[i].message);
        							}
        							else {
        								makePost(pictureLink,posts[i].story,posts[i].created_time,posts[i].message);
        							}
        						}
                               } //end complete 
                  }); //end ajax
                       } //end getInfo

    	function makePost(link,story,time,message) {
    		var one = '<div class="row card-panel"><div class="col s2" align="center"><img class="circle responsive-img profilePic" src="';
    		var two = '"></div><div class="col s10"><div class="row"><div class="col s10 left"><h5>';
    		var three = '</h5></div><div class="col s10">';
    		var four = '</div></div></div><div class="col s12 flow-text center-align">';
    		var five = '</div></div>';
    		$(".postsContainer").append(one+link+two+story+three+time+four+message+five);
    	};
        
	});
</script>
</html>